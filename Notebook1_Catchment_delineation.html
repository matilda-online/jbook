
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Catchment delineation &#8212; MATILDA</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Notebook1_Catchment_delineation';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Climate forcing data" href="Notebook2_Forcing_data.html" />
    <link rel="prev" title="Introduction" href="Notebook0_Introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="Notebook0_Introduction.html">
  
  
  
  
  
    
    
      
    
    
    <img src="https://www.hu-berlin.de/++resource++humboldt.logo.Logo.svg" class="logo__image only-light" alt="MATILDA - Home"/>
    <img src="https://www.hu-berlin.de/++resource++humboldt.logo.Logo.svg" class="logo__image only-dark pst-js-only" alt="MATILDA - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="Notebook0_Introduction.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Catchment delineation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook2_Forcing_data.html">Climate forcing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook3_CMIP6.html">Climate scenario data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook4_MATILDA.html">Calibrating the MATILDA framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook5_MATILDA_scenarios.html">MATILDA Scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook6_Analysis.html">Model Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook7_Climate_Change_Impact.html">Climate Change Impact Analysis</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/phiscu/matilda_edu/main?urlpath=lab/tree/Notebook1_Catchment_delineation.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/phiscu/matilda_edu" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/phiscu/matilda_edu/issues/new?title=Issue%20on%20page%20%2FNotebook1_Catchment_delineation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Notebook1_Catchment_delineation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Catchment delineation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#start-gee-and-download-dem">Start GEE and download DEM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catchment-deliniation">Catchment deliniation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-glaciers-in-catchment-area">Determine glaciers in catchment area</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim Summary:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-ice-thickness-rasters-and-corresponding-dem-files">Retrieve ice thickness rasters and corresponding DEM files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glacier-profile-creation">Glacier profile creation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#store-calculated-values-for-other-notebooks">Store calculated values for other notebooks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-download-outputs"><em>Optional</em>: Download Outputs</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="catchment-delineation">
<h1>Catchment delineation<a class="headerlink" href="#catchment-delineation" title="Link to this heading">#</a></h1>
<p>We start our workflow by downloading all the static data we need. In this notebook we will</p>
<ol class="arabic simple">
<li><p>…download a <strong>Digital Elevation Model</strong> (DEM) for hydrologic applications,</p></li>
<li><p>…<strong>delineate the catchment</strong> and determine the <strong>catchment area</strong> using your reference position (e.g. the location of your gauging station) as the “pouring point”,</p></li>
<li><p>…identify all glaciers within the catchment and download the <strong>glacier outlines and ice thicknesses</strong>,</p></li>
<li><p>…create a glacier profile based on elevation zones.</p></li>
</ol>
<p>The DEM will be downloaded from Google Earth Engine (GEE). The default is the [MERIT DEM] (https://developers.google.com/earth-engine/datasets/catalog/MERIT_DEM_v1_0_3), but you can use any DEM available in the <em>Google Earth Engine Data Catalog</em> (https://developers.google.com/earth-engine/datasets/catalog) by specifying it in the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file.</p>
<p>Let’s start by importing the necessary packages and defining functions/constants.</p>
<p>First of all, the Google Earth Engine (GEE) access must be initialized. If this is the first time you run the notebook on this machine, you need to authenticate. When using <code>mybinder.org</code> you need to authenticate every time a new session has been launched. Follow the instructions on screen or see the guide in → <a class="reference internal" href="Notebook0_Introduction.html#Authorize-access-for-Google-Earth-Engine"><span class="std std-ref">Notebook 0</span></a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ee</span>

<span class="c1"># initialize GEE at the beginning of session</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">ee</span><span class="o">.</span><span class="n">Authenticate</span><span class="p">()</span>         <span class="c1"># authenticate when using GEE for the first time</span>
    <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Now we will read some settings from the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file:</p>
<ul class="simple">
<li><p><strong>input/output</strong> folders for data imports and downloads</p></li>
<li><p><strong>filenames</strong> (DEM, GeoPackage)</p></li>
<li><p><strong>coordinates</strong> of the defined “pouring” point (Lat/Long)</p></li>
<li><p>chosen <strong>DEM</strong> from GEE data catalog</p></li>
<li><p><strong>show/hide GEE map</strong> in notebooks</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scienceplots</span>

<span class="c1"># read local config.ini file</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;config.ini&#39;</span><span class="p">)</span>

<span class="c1"># get file config from config.ini</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FILE_SETTINGS&#39;</span><span class="p">][</span><span class="s1">&#39;DIR_OUTPUT&#39;</span><span class="p">]</span>
<span class="n">figures_folder</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FILE_SETTINGS&#39;</span><span class="p">][</span><span class="s1">&#39;DIR_FIGURES&#39;</span><span class="p">]</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">output_folder</span> <span class="o">+</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FILE_SETTINGS&#39;</span><span class="p">][</span><span class="s1">&#39;DEM_FILENAME&#39;</span><span class="p">]</span>
<span class="n">output_gpkg</span> <span class="o">=</span> <span class="n">output_folder</span> <span class="o">+</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FILE_SETTINGS&#39;</span><span class="p">][</span><span class="s1">&#39;GPKG_NAME&#39;</span><span class="p">]</span>

<span class="c1"># get used GEE DEM, coords and other settings</span>
<span class="n">dem_config</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CONFIG&#39;</span><span class="p">][</span><span class="s1">&#39;DEM&#39;</span><span class="p">])</span>
<span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CONFIG&#39;</span><span class="p">][</span><span class="s1">&#39;COORDS&#39;</span><span class="p">])</span>
<span class="n">show_map</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;CONFIG&#39;</span><span class="p">,</span><span class="s1">&#39;SHOW_MAP&#39;</span><span class="p">)</span>

<span class="c1"># get style for matplotlib plots</span>
<span class="n">plt_style</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CONFIG&#39;</span><span class="p">][</span><span class="s1">&#39;PLOT_STYLE&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">plt_style</span><span class="p">)</span>

<span class="c1"># print config data</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Used DEM: </span><span class="si">{</span><span class="n">dem_config</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Coordinates of discharge point: Lat </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">, Lon </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Used DEM: MERIT 30m
Coordinates of discharge point: Lat 42.300264, Lon 78.091444
</pre></div>
</div>
</div>
</div>
<section id="start-gee-and-download-dem">
<h2>Start GEE and download DEM<a class="headerlink" href="#start-gee-and-download-dem" title="Link to this heading">#</a></h2>
<p>Once we are set up, we can start working with the data. Let’s start with the <strong>base map</strong>, if enabled in <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. The map can be used to follow the steps as more layers are added throughout the notebook. <a id="map"></a></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geemap</span>

<span class="k">if</span> <span class="n">show_map</span><span class="p">:</span>
    <span class="n">Map</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">Map</span><span class="p">()</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Map</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Map view disabled in config.ini&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "43930d4cbdc04514bac42160313e8ae1", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Now we can add the DEM from the GEE catalog and add it as a new layer to the map.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">dem_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Image&#39;</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">dem_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">dem_config</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">elif</span> <span class="n">dem_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ImageCollection&#39;</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">dem_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">dem_config</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">mosaic</span><span class="p">()</span>

<span class="k">if</span> <span class="n">show_map</span><span class="p">:</span>
    <span class="n">srtm_vis</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;bands&#39;</span><span class="p">:</span> <span class="n">dem_config</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">6000</span><span class="p">,</span>
                <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;000000&#39;</span><span class="p">,</span> <span class="s1">&#39;478FCD&#39;</span><span class="p">,</span> <span class="s1">&#39;86C58E&#39;</span><span class="p">,</span> <span class="s1">&#39;AFC35E&#39;</span><span class="p">,</span> <span class="s1">&#39;8F7131&#39;</span><span class="p">,</span><span class="s1">&#39;B78D4F&#39;</span><span class="p">,</span> <span class="s1">&#39;E2B8A6&#39;</span><span class="p">,</span> <span class="s1">&#39;FFFFFF&#39;</span><span class="p">]</span>
               <span class="p">}</span>

    <span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">srtm_vis</span><span class="p">,</span> <span class="n">dem_config</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Next, we add the configured discharge point to the map and generate a <strong>40km</strong> buffer box.</p>
<div class="alert alert-block alert-info">
    <b>Note:</b> Please check whether the default box covers your research area. Alternatively, you can adjust the box manually. <b>The catchment area will be cropped if the selected box is too small.</b></div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">box</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">40000</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>

<span class="k">if</span> <span class="n">show_map</span><span class="p">:</span>
    <span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">point</span><span class="p">,{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">},</span><span class="s1">&#39;Discharge Point&#39;</span><span class="p">)</span>
    <span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">box</span><span class="p">,{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;grey&#39;</span><span class="p">},</span><span class="s1">&#39;Catchment Area&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="n">Map</span><span class="o">.</span><span class="n">centerObject</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>The discharge point (marker) and box (polygon/rectangle) can also be added manually to the map above. If features have been drawn, they will overrule the configured discharge point and automatically created box.</p>
<p><a id="rp01"><strong>Restart Point #1</strong></a></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">show_map</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">Map</span><span class="o">.</span><span class="n">draw_features</span><span class="p">:</span>
        <span class="n">f_type</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">f_type</span> <span class="o">==</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Manually set pouring point will be considered&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">f_type</span> <span class="o">==</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Manually drawn box will be considered&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<p>Now we can export the DEM as a <code class="docutils literal notranslate"><span class="pre">.tif</span></code> file for the selected extent to the output folder. Depending on the size of the selected area, this might take a while for processing and downloading.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">rioxarray</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Get GEE data as Xarray...&#39;</span><span class="p">)</span>
    <span class="n">ic</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
        <span class="n">ic</span><span class="p">,</span>
        <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;ee&#39;</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="n">ic</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">projection</span><span class="p">(),</span>
        <span class="n">geometry</span><span class="o">=</span><span class="n">box</span>
    <span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prepare Xarray for GeoTiff conversion...&#39;</span><span class="p">)</span>
    <span class="n">ds_t</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">ds_t</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_spatial_dims</span><span class="p">(</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Save DEM as GeoTiff...&#39;</span><span class="p">)</span>
    <span class="n">ds_t</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">to_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEM successfully saved at&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error during Xarray routine. Try direct download from GEE...&#39;</span><span class="p">)</span>
    <span class="n">geemap</span><span class="o">.</span><span class="n">ee_export_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">box</span><span class="p">,</span> <span class="n">file_per_band</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get GEE data as Xarray...
Prepare Xarray for GeoTiff conversion...
Save DEM as GeoTiff...
DEM successfully saved at output/dem_gee.tif
</pre></div>
</div>
</div>
</div>
</section>
<section id="catchment-deliniation">
<h2>Catchment deliniation<a class="headerlink" href="#catchment-deliniation" title="Link to this heading">#</a></h2>
<p>Based on the downloaded DEM file, we can calculate a catchment area using the <code>pysheds</code> library. The result will be a raster and displayed at the end of this section.</p>
<p>The full documentation of the <code>pysheds</code> module can be found <a class="reference external" href="https://mattbartos.com/pysheds/">here</a>.</p>
<div class="alert alert-block alert-info">
<b>Note:</b> The catchment delineation involves several steps with large array operations and can take a moment.</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1"># GIS packages</span>
<span class="kn">from</span> <span class="nn">pysheds.grid</span> <span class="kn">import</span> <span class="n">Grid</span>
<span class="kn">import</span> <span class="nn">fiona</span>

<span class="c1"># load DEM</span>
<span class="n">DEM_file</span> <span class="o">=</span> <span class="n">filename</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_raster</span><span class="p">(</span><span class="n">DEM_file</span><span class="p">)</span>
<span class="n">dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">read_raster</span><span class="p">(</span><span class="n">DEM_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEM loaded.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEM loaded.
CPU times: user 906 ms, sys: 140 ms, total: 1.05 s
Wall time: 1.33 s
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1"># Fill depressions in DEM</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fill depressions in DEM...&quot;</span><span class="p">)</span>
<span class="n">flooded_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fill_depressions</span><span class="p">(</span><span class="n">dem</span><span class="p">)</span>
<span class="c1"># Resolve flats in DEM</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resolve flats in DEM...&quot;</span><span class="p">)</span>
<span class="n">inflated_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">resolve_flats</span><span class="p">(</span><span class="n">flooded_dem</span><span class="p">)</span>

<span class="c1"># Specify directional mapping</span>
<span class="c1">#N    NE    E    SE    S    SW    W    NW</span>
<span class="n">dirmap</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="c1"># Compute flow directions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Compute flow directions...&quot;</span><span class="p">)</span>
<span class="n">fdir</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">flowdir</span><span class="p">(</span><span class="n">inflated_dem</span><span class="p">,</span> <span class="n">dirmap</span><span class="o">=</span><span class="n">dirmap</span><span class="p">)</span>
<span class="c1">#catch = grid.catchment(x=x, y=y, fdir=fdir, dirmap=dirmap, xytype=&#39;coordinate&#39;)</span>
<span class="c1"># Compute accumulation</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Compute accumulation...&quot;</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">accumulation</span><span class="p">(</span><span class="n">fdir</span><span class="p">)</span>
<span class="c1"># Snap pour point to high accumulation cell</span>
<span class="n">x_snap</span><span class="p">,</span> <span class="n">y_snap</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">snap_to_mask</span><span class="p">(</span><span class="n">acc</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="c1"># Delineate the catchment</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Delineate the catchment...&quot;</span><span class="p">)</span>
<span class="n">catch</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">catchment</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_snap</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_snap</span><span class="p">,</span> <span class="n">fdir</span><span class="o">=</span><span class="n">fdir</span><span class="p">,</span> <span class="n">xytype</span><span class="o">=</span><span class="s1">&#39;coordinate&#39;</span><span class="p">)</span>
<span class="c1"># Clip the DEM to the catchment</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clip the DEM to the catchment...&quot;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">clip_to</span><span class="p">(</span><span class="n">catch</span><span class="p">)</span>
<span class="n">clipped_catch</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">catch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing completed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fill depressions in DEM...
Resolve flats in DEM...
Compute flow directions...
Compute accumulation...
Delineate the catchment...
Clip the DEM to the catchment...
Processing completed.
CPU times: user 1.06 s, sys: 36.1 ms, total: 1.1 s
Wall time: 1.08 s
</pre></div>
</div>
</div>
</div>
<p>Now let’s have a look at the catchment area.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Define a function to plot the digital elevation model</span>
<span class="k">def</span> <span class="nf">plotFigure</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">extent</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">demView</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">plotFigure</span><span class="p">(</span><span class="n">demView</span><span class="p">,</span><span class="s1">&#39;Elevation in Meters&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figures_folder</span><span class="o">+</span><span class="s1">&#39;NB1_DEM_Catchment.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><img alt="_images/01a220696fdd54ac508dfb16352d5387d8e42fb34be9f44eebb9bf668ca23d54.png" src="_images/01a220696fdd54ac508dfb16352d5387d8e42fb34be9f44eebb9bf668ca23d54.png" />
</div>
</div>
<p>For the following steps we need the catchment outline as a polygon. Thus, we convert the <strong>raster to a polygon</strong> and save both in a <strong>geopackage</strong> to the output folder. From these files, we can already calculate important <strong>catchment statistics</strong> needed for the glacio-hydrological model in Notebook 4.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">shape</span>
<span class="kn">from</span> <span class="nn">shapely.ops</span> <span class="kn">import</span> <span class="n">transform</span>
<span class="kn">import</span> <span class="nn">pyproj</span>

<span class="c1"># Create shapefile and save it</span>
<span class="n">shapes</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">polygonize</span><span class="p">()</span>

<span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;LABEL&#39;</span><span class="p">:</span> <span class="s1">&#39;float:16&#39;</span><span class="p">}</span>
<span class="p">}</span>

<span class="n">catchment_shape</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">layer_name</span> <span class="o">=</span> <span class="s1">&#39;catchment_orig&#39;</span>
<span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output_gpkg</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                <span class="c1">#driver=&#39;ESRI Shapefile&#39;,#</span>
                <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GPKG&#39;</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span>
                <span class="n">crs</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">srs</span><span class="p">,</span>
                <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="n">catchment_shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LABEL&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)}</span>
        <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> 

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer &#39;</span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">&#39; added to GeoPackage &#39;</span><span class="si">{</span><span class="n">output_gpkg</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
<span class="n">catchment_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">demView</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">demView</span><span class="p">))]</span>
<span class="n">ele_cat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">demView</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Catchment elevation ranges from </span><span class="si">{</span><span class="n">catchment_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> m to </span><span class="si">{</span><span class="n">catchment_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> m.a.s.l.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean catchment elevation is </span><span class="si">{</span><span class="n">ele_cat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m.a.s.l.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Layer &#39;catchment_orig&#39; added to GeoPackage &#39;output/catchment_data.gpkg&#39;

Catchment elevation ranges from 1970 m to 4791 m.a.s.l.
Mean catchment elevation is 3274.68 m.a.s.l.
</pre></div>
</div>
</div>
</div>
<p>We can also add the catchment polygon to the interactive map. This sends it to GEE and allows us to use a GEE function to calculate its area. Please scroll up to see the results on the map.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catchment</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">catchment_shape</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])</span>
<span class="k">if</span> <span class="n">show_map</span><span class="p">:</span>
    <span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">catchment</span><span class="p">,</span> <span class="p">{},</span> <span class="s1">&#39;Catchment&#39;</span><span class="p">)</span>

<span class="n">catchment_area</span> <span class="o">=</span> <span class="n">catchment</span><span class="o">.</span><span class="n">area</span><span class="p">()</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Catchment area is </span><span class="si">{</span><span class="n">catchment_area</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km²&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Catchment area is 301.37 km²
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-warning">
<b>Note:</b>
 Please make sure to leave some buffer between the catchment outline and the used box (&rarr; <a href='#map'>Jump to map</a>). If the bounding box is close to the catchment, please extent the box and repeat the DEM download and catchment delineation (&rarr; use <a href='#rp01'>Restart Point #1</a>).</div>
<p>Example:</p>
<ol class="arabic simple">
<li><p>The automatically created box for the pouring point (in gray) is not sufficient to cover the entire catchment area; cropped at the eastern edge.</p></li>
<li><p>Manually drawn box (in blue) has been added to ensure that the catchment is not cropped → buffer remains on all edges</p></li>
</ol>
<p><img alt="Example for Cropped Catchment" src="_images/gee_catchment_extent.png" /></p>
</section>
<hr class="docutils" />
<section id="determine-glaciers-in-catchment-area">
<h2>Determine glaciers in catchment area<a class="headerlink" href="#determine-glaciers-in-catchment-area" title="Link to this heading">#</a></h2>
<p>To acquire outlines of all glaciers in the catchment we will rely on latest Randolph Glacier Inventory (RGI 6.0).</p>
<blockquote>
<div><p>The <em>Randolph Glacier Inventory (RGI 6.0)</em> is a global inventory of glacier outlines. It is supplemental to the Global Land Ice Measurements from Space initiative (GLIMS). Production of the RGI was motivated by the Fifth Assessment Report of the Intergovernmental Panel on Climate Change (IPCC AR5). Future updates will be made to the RGI and the GLIMS Glacier Database in parallel during a transition period. As all these data are incorporated into the GLIMS Glacier Database and as download tools are developed to obtain GLIMS data in the RGI data format, the RGI will evolve into a downloadable subset of GLIMS, offering complete one-time coverage, version control, and a standard set of attributes.</p>
<p>Source: https://www.glims.org/RGI/</p>
</div></blockquote>
<p>The RGI dataset is divided into 19 so called <em>first-order regions</em>.</p>
<blockquote>
<div><p>RGI regions were developed under only three constraints: that they should resemble commonly recognized glacier domains, that together they should contain all of the world’s glaciers, and that their boundaries should be simple and readily recognizable on a map of the world.</p>
<p>Source: <a class="reference external" href="https://doi.org/10.3189/2014jog13j176">Pfeffer et.al. 2014</a></p>
</div></blockquote>
<p><img alt="Map of the RGI regions; the red dots indicate the glacier locations and the blue circles the location of the 254 reference WGMS glaciers used by the OGGM calibration" src="https://docs.oggm.org/en/v1.2.0/_images/wgms_rgi_map.png" /></p>
<p>In the first step, the RGI region of the catchment area must be determined to access the correct repository. Therefore, the RGI region outlines will be downloaded from the official website and joined with the catchment outline.</p>
<blockquote>
<div><p>Source: <a class="reference external" href="https://doi.org/10.7265/4m1f-gd79">RGI Consortium (2017)</a></p>
</div></blockquote>
<div class="cell tag_output_scroll tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="c1"># load catcment and RGI regions as DF</span>
<span class="n">catchment</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">output_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;catchment_orig&#39;</span><span class="p">)</span>
<span class="n">df_regions</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;https://www.glims.org/RGI/rgi60_files/00_rgi60_regions.zip&#39;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;00_rgi60_O1Regions&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_regions</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FULL_NAME</th>
      <th>RGI_CODE</th>
      <th>WGMS_CODE</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alaska</td>
      <td>1</td>
      <td>ALA</td>
      <td>POLYGON ((-133 54.5, -134 54.5, -134 54, -134 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>1</td>
      <td>ALA</td>
      <td>POLYGON ((180 50, 179 50, 178 50, 177 50, 176 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Western Canada and USA</td>
      <td>2</td>
      <td>WNA</td>
      <td>POLYGON ((-133 54.5, -132 54.5, -131 54.5, -13...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arctic Canada, North</td>
      <td>3</td>
      <td>ACN</td>
      <td>POLYGON ((-125 74, -125 75, -125 76, -125 77, ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arctic Canada, South</td>
      <td>4</td>
      <td>ACS</td>
      <td>POLYGON ((-90 74, -89 74, -88 74, -87 74, -86 ...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Greenland Periphery</td>
      <td>5</td>
      <td>GRL</td>
      <td>POLYGON ((-75 77, -74.73 77.51, -74.28 78.06, ...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Iceland</td>
      <td>6</td>
      <td>ISL</td>
      <td>POLYGON ((-26 59, -26 60, -26 61, -26 62, -26 ...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Svalbard and Jan Mayen</td>
      <td>7</td>
      <td>SJM</td>
      <td>POLYGON ((-10 70, -10 71, -10 72, -10 73, -10 ...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Scandinavia</td>
      <td>8</td>
      <td>SCA</td>
      <td>POLYGON ((4 70, 4 71, 4 72, 4 73, 4 74, 5 74, ...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Russian Arctic</td>
      <td>9</td>
      <td>RUA</td>
      <td>POLYGON ((35 70, 35 71, 35 72, 35 73, 35 74, 3...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Asia, North</td>
      <td>10</td>
      <td>ASN</td>
      <td>POLYGON ((-180 78, -179 78, -178 78, -177 78, ...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Asia, North</td>
      <td>10</td>
      <td>ASN</td>
      <td>POLYGON ((128 46, 127 46, 126 46, 125 46, 124 ...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Central Europe</td>
      <td>11</td>
      <td>CEU</td>
      <td>POLYGON ((-6 40, -6 41, -6 42, -6 43, -6 44, -...</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Caucasus and Middle East</td>
      <td>12</td>
      <td>CAU</td>
      <td>POLYGON ((32 31, 32 32, 32 33, 32 34, 32 35, 3...</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Asia, Central</td>
      <td>13</td>
      <td>ASC</td>
      <td>POLYGON ((80 46, 81 46, 82 46, 83 46, 84 46, 8...</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Asia, South West</td>
      <td>14</td>
      <td>ASW</td>
      <td>POLYGON ((75.4 26, 75 26, 74 26, 73 26, 72 26,...</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Asia, South East</td>
      <td>15</td>
      <td>ASE</td>
      <td>POLYGON ((75.4 26, 75.4 27, 75.4 27.62834, 75....</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Low Latitudes</td>
      <td>16</td>
      <td>TRP</td>
      <td>POLYGON ((-100 -25, -100 -24, -100 -23, -100 -...</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Southern Andes</td>
      <td>17</td>
      <td>SAN</td>
      <td>POLYGON ((-62 -45.5, -62 -46, -62 -47, -62 -48...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>New Zealand</td>
      <td>18</td>
      <td>NZL</td>
      <td>POLYGON ((179 -49, 178 -49, 177 -49, 176 -49, ...</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Antarctic and Subantarctic</td>
      <td>19</td>
      <td>ANT</td>
      <td>POLYGON ((-180 -45.5, -179 -45.5, -178 -45.5, ...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For spatial calculations it is crucial to use the correct projection. To avoid inaccuracies due to unit conversions we will project the data to UTM whenever we calculate spatial statistics. The relevant UTM zone and band for the catchment area are determined from the coordinates of the pouring point.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">utm</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">CRS</span>

<span class="n">utm_zone</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UTM zone &#39;</span><span class="si">{</span><span class="n">utm_zone</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;, band &#39;</span><span class="si">{</span><span class="n">utm_zone</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="c1"># get CRS based on UTM</span>
<span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;proj&#39;</span><span class="p">:</span><span class="s1">&#39;utm&#39;</span><span class="p">,</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span><span class="n">utm_zone</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;south&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>

<span class="n">catchment_area</span> <span class="o">=</span> <span class="n">catchment</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Catchment area (projected) is </span><span class="si">{</span><span class="n">catchment_area</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km²&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UTM zone &#39;44&#39;, band &#39;T&#39;
Catchment area (projected) is 302.00 km²
</pre></div>
</div>
</div>
</div>
<p>Now we can perform a spatial join between the catchment outline and the RGI regions. If the catchment contains any glaciers, the corresponding RGI region is determined in this step.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_regions</span> <span class="o">=</span> <span class="n">df_regions</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">allow_override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">catchment</span> <span class="o">=</span> <span class="n">catchment</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
<span class="n">df_regions_catchment</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">df_regions</span><span class="p">,</span> <span class="n">catchment</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="s2">&quot;intersects&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_regions_catchment</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No area found for catchment&#39;</span><span class="p">)</span>
    <span class="n">rgi_region</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_regions_catchment</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">rgi_region</span> <span class="o">=</span> <span class="n">df_regions_catchment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RGI_CODE&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Catchment belongs to RGI region </span><span class="si">{</span><span class="n">rgi_region</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">df_regions_catchment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;FULL_NAME&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Catchment belongs to more than one region. This use case is not yet supported.&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df_regions_catchment</span><span class="p">)</span>
    <span class="n">rgi_region</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Catchment belongs to RGI region 13 (Asia, Central)
</pre></div>
</div>
</div>
</div>
<p>In the next step, the glacier inventory outlines for the determined RGI region will be downloaded. A spatial join is performed to determine all glacier outlines that intersect with the catchment area.</p>
<div class="alert alert-block alert-info">
<b>Note:</b>
 Depending on the region and bandwidth, this might take 1 min or longer.</div> <div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">fsspec</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">if</span> <span class="n">rgi_region</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.glims.org/RGI/rgi60_files/&quot;</span>  <span class="c1"># Replace with the URL of your web server</span>
    <span class="n">html_page</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">=</span> <span class="n">html_page</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading Randolph Glacier Inventory 6.0 in GLIMS database...&#39;</span><span class="p">)</span>

    <span class="c1"># Use regular expressions to find links to files</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;href=&quot;([^&quot;]+\.zip)&quot;&#39;</span><span class="p">)</span>
    <span class="n">file_links</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_links</span><span class="p">:</span>
        <span class="n">splits</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rgi_region</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># starting scanning regions</span>
        <span class="n">regionname</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">splits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Locating glacier outlines in RGI Region </span><span class="si">{</span><span class="n">regionname</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

        <span class="c1"># read zip into dataframe</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading shapefiles...&#39;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;simplecache::</span><span class="si">{</span><span class="n">url</span><span class="o">+</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Path:&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">rgi</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rgi</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="n">catchment</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CRS adjusted&quot;</span><span class="p">)</span>
            <span class="n">catchment</span> <span class="o">=</span> <span class="n">catchment</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">rgi</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

        <span class="c1"># check whether catchment intersects with glaciers of region</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Perform spatial join...&#39;</span><span class="p">)</span>
        <span class="n">rgi_catchment</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">rgi</span><span class="p">,</span><span class="n">catchment</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span><span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;intersects&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgi_catchment</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rgi_catchment</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s1"> outlines loaded from RGI Region </span><span class="si">{</span><span class="n">regionname</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading Randolph Glacier Inventory 6.0 in GLIMS database...
Locating glacier outlines in RGI Region 13 (CentralAsia)...
Loading shapefiles...
Path: simplecache::https://www.glims.org/RGI/rgi60_files/13_rgi60_CentralAsia.zip
Perform spatial join...
51 outlines loaded from RGI Region 13 (CentralAsia)

CPU times: user 1.3 s, sys: 699 ms, total: 2 s
Wall time: 11 s
</pre></div>
</div>
</div>
</div>
<p>Some glaciers are not actually in the catchment, but intersect its outline. We will first determine their fractional overlap with the target catchment.</p>
<div class="cell tag_output_scroll tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># intersects selects too many. calculate percentage of glacier area that is within catchment</span>
<span class="n">rgi_catchment</span><span class="p">[</span><span class="s1">&#39;rgi_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgi_catchment</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">area</span>
    
<span class="n">gdf_joined</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">catchment</span><span class="p">,</span> <span class="n">rgi_catchment</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;union&#39;</span><span class="p">)</span>
<span class="n">gdf_joined</span><span class="p">[</span><span class="s1">&#39;area_joined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_joined</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">area</span>
<span class="n">gdf_joined</span><span class="p">[</span><span class="s1">&#39;share_of_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_joined</span><span class="p">[</span><span class="s1">&#39;area_joined&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">gdf_joined</span><span class="p">[</span><span class="s1">&#39;rgi_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_joined</span>
           <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;RGIId&#39;</span><span class="p">,</span> <span class="s1">&#39;LABEL_1&#39;</span><span class="p">])</span>
           <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;share_of_area&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">}))</span>

<span class="n">display</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;share_of_area&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>share_of_area</th>
    </tr>
    <tr>
      <th>RGIId</th>
      <th>LABEL_1</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RGI60-13.06380</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06364</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06355</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06374</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06379</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06373</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06360</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06368</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06376</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06372</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06367</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06369</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06358</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06356</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06361</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06370</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06357</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06366</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06365</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06363</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06362</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.07927</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06371</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.07926</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06375</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.06381</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.07719</th>
      <th>1.0</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>RGI60-13.07930</th>
      <th>1.0</th>
      <td>99.910066</td>
    </tr>
    <tr>
      <th>RGI60-13.06377</th>
      <th>1.0</th>
      <td>99.800692</td>
    </tr>
    <tr>
      <th>RGI60-13.07718</th>
      <th>1.0</th>
      <td>99.743848</td>
    </tr>
    <tr>
      <th>RGI60-13.06359</th>
      <th>1.0</th>
      <td>99.707638</td>
    </tr>
    <tr>
      <th>RGI60-13.07931</th>
      <th>1.0</th>
      <td>99.438704</td>
    </tr>
    <tr>
      <th>RGI60-13.06378</th>
      <th>1.0</th>
      <td>99.357849</td>
    </tr>
    <tr>
      <th>RGI60-13.06425</th>
      <th>1.0</th>
      <td>98.842830</td>
    </tr>
    <tr>
      <th>RGI60-13.06382</th>
      <th>1.0</th>
      <td>98.106150</td>
    </tr>
    <tr>
      <th>RGI60-13.07717</th>
      <th>1.0</th>
      <td>97.041495</td>
    </tr>
    <tr>
      <th>RGI60-13.06354</th>
      <th>1.0</th>
      <td>90.109684</td>
    </tr>
    <tr>
      <th>RGI60-13.06353</th>
      <th>1.0</th>
      <td>70.494633</td>
    </tr>
    <tr>
      <th>RGI60-13.06397</th>
      <th>1.0</th>
      <td>7.070227</td>
    </tr>
    <tr>
      <th>RGI60-13.06395</th>
      <th>1.0</th>
      <td>5.427778</td>
    </tr>
    <tr>
      <th>RGI60-13.06451</th>
      <th>1.0</th>
      <td>5.007275</td>
    </tr>
    <tr>
      <th>RGI60-13.07891</th>
      <th>1.0</th>
      <td>2.740915</td>
    </tr>
    <tr>
      <th>RGI60-13.06452</th>
      <th>1.0</th>
      <td>2.458845</td>
    </tr>
    <tr>
      <th>RGI60-13.06421</th>
      <th>1.0</th>
      <td>2.441032</td>
    </tr>
    <tr>
      <th>RGI60-13.06396</th>
      <th>1.0</th>
      <td>2.299352</td>
    </tr>
    <tr>
      <th>RGI60-13.06424</th>
      <th>1.0</th>
      <td>1.298328</td>
    </tr>
    <tr>
      <th>RGI60-13.07925</th>
      <th>1.0</th>
      <td>1.009748</td>
    </tr>
    <tr>
      <th>RGI60-13.06426</th>
      <th>1.0</th>
      <td>0.532787</td>
    </tr>
    <tr>
      <th>RGI60-13.06387</th>
      <th>1.0</th>
      <td>0.149275</td>
    </tr>
    <tr>
      <th>RGI60-13.06386</th>
      <th>1.0</th>
      <td>0.104987</td>
    </tr>
    <tr>
      <th>RGI60-13.06454</th>
      <th>1.0</th>
      <td>0.019441</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we can <strong>filter</strong> based on the percentage of shared area. After that the catchment area will be adjusted as follows:</p>
<ul class="simple">
<li><p><strong>≥50%</strong> of the area are in the catchment → <strong>include</strong> and extend catchment area by full glacier outlines (if needed)</p></li>
<li><p><strong>&lt;50%</strong> of the area are in the catchment → <strong>exclude</strong> and reduce catchment area by glacier outlines (if needed)</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rgi_catchment_merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rgi_catchment</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;RGIId&quot;</span><span class="p">)</span>
<span class="n">rgi_in_catchment</span> <span class="o">=</span> <span class="n">rgi_catchment_merge</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rgi_catchment_merge</span><span class="p">[</span><span class="s1">&#39;share_of_area&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">]</span>
<span class="n">rgi_out_catchment</span> <span class="o">=</span> <span class="n">rgi_catchment_merge</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rgi_catchment_merge</span><span class="p">[</span><span class="s1">&#39;share_of_area&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">]</span>
<span class="n">catchment_new</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">catchment</span><span class="p">,</span> <span class="n">rgi_out_catchment</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;difference&#39;</span><span class="p">)</span>
<span class="n">catchment_new</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">catchment_new</span><span class="p">,</span> <span class="n">rgi_in_catchment</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;union&#39;</span><span class="p">)</span>
<span class="n">catchment_new</span> <span class="o">=</span> <span class="n">catchment_new</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()[[</span><span class="s1">&#39;LABEL_1&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Total number of determined glacier outlines: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rgi_catchment_merge</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of included glacier outlines (overlap &gt;= 50%): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rgi_in_catchment</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of excluded glacier outlines (overlap &lt; 50%): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rgi_out_catchment</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total number of determined glacier outlines: 51
Number of included glacier outlines (overlap &gt;= 50%): 38
Number of excluded glacier outlines (overlap &lt; 50%): 13
</pre></div>
</div>
</div>
</div>
<p>The RGI-IDs of the remaining glaciers are stored in <code class="docutils literal notranslate"><span class="pre">Glaciers_in_catchment.csv</span></code>.</p>
<div class="cell tag_output_scroll tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="n">Path</span><span class="p">(</span><span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;RGI&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">glacier_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rgi_in_catchment</span><span class="p">)</span>
<span class="n">glacier_ids</span><span class="p">[</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">glacier_ids</span><span class="p">[</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;RGI60-&#39;</span><span class="p">))</span>
<span class="n">glacier_ids</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;RGI/&#39;</span> <span class="o">+</span> <span class="s1">&#39;Glaciers_in_catchment.csv&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RGIId&#39;</span><span class="p">,</span> <span class="s1">&#39;GLIMSId&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">glacier_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RGIId</th>
      <th>GLIMSId</th>
      <th>BgnDate</th>
      <th>EndDate</th>
      <th>CenLon</th>
      <th>CenLat</th>
      <th>O1Region</th>
      <th>O2Region</th>
      <th>Area</th>
      <th>Zmin</th>
      <th>...</th>
      <th>Form</th>
      <th>TermType</th>
      <th>Surging</th>
      <th>Linkages</th>
      <th>Name</th>
      <th>geometry</th>
      <th>index_right</th>
      <th>LABEL</th>
      <th>rgi_area</th>
      <th>share_of_area</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13.06353</td>
      <td>G078245E42230N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.245360</td>
      <td>42.230246</td>
      <td>13</td>
      <td>3</td>
      <td>0.122</td>
      <td>3827</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.2473 42.22858, 78.24725 42.22858,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.224364e+05</td>
      <td>70.494633</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13.06354</td>
      <td>G078260E42217N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.259558</td>
      <td>42.216524</td>
      <td>13</td>
      <td>3</td>
      <td>0.269</td>
      <td>3788</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.25962 42.21159, 78.25962 42.21161...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.689387e+05</td>
      <td>90.109684</td>
    </tr>
    <tr>
      <th>2</th>
      <td>13.06355</td>
      <td>G078253E42212N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.252936</td>
      <td>42.211929</td>
      <td>13</td>
      <td>3</td>
      <td>0.177</td>
      <td>3640</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.25481 42.2114, 78.25437 42.21124,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.772685e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13.06356</td>
      <td>G078242E42208N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.241914</td>
      <td>42.207501</td>
      <td>13</td>
      <td>3</td>
      <td>0.397</td>
      <td>3665</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.24325 42.20383, 78.24278 42.20365...</td>
      <td>0</td>
      <td>1.0</td>
      <td>3.976880e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>13.06357</td>
      <td>G078259E42209N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.258704</td>
      <td>42.209002</td>
      <td>13</td>
      <td>3</td>
      <td>0.053</td>
      <td>3870</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.2596 42.20812, 78.25958 42.20812,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>5.305518e+04</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13.06358</td>
      <td>G078286E42186N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.285595</td>
      <td>42.185778</td>
      <td>13</td>
      <td>3</td>
      <td>0.082</td>
      <td>3893</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.28462 42.18393, 78.28461 42.18394...</td>
      <td>0</td>
      <td>1.0</td>
      <td>8.178833e+04</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>13.06359</td>
      <td>G078305E42146N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.304754</td>
      <td>42.146142</td>
      <td>13</td>
      <td>3</td>
      <td>4.201</td>
      <td>3362</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>1</td>
      <td>Karabatkak Glacier</td>
      <td>POLYGON ((78.30373 42.14478, 78.30374 42.1449,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>4.202605e+06</td>
      <td>99.707638</td>
    </tr>
    <tr>
      <th>7</th>
      <td>13.06360</td>
      <td>G078285E42147N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.284766</td>
      <td>42.146579</td>
      <td>13</td>
      <td>3</td>
      <td>0.253</td>
      <td>3689</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.2866 42.14613, 78.2866 42.14613, ...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.530299e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>13.06361</td>
      <td>G078273E42140N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.272803</td>
      <td>42.140310</td>
      <td>13</td>
      <td>3</td>
      <td>2.046</td>
      <td>3328</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.27549 42.13342, 78.27502 42.13358...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.047230e+06</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>13.06362</td>
      <td>G078260E42141N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.260391</td>
      <td>42.140731</td>
      <td>13</td>
      <td>3</td>
      <td>0.140</td>
      <td>3912</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.25779 42.1406, 78.25783 42.14063,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.402120e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>13.06363</td>
      <td>G078257E42156N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.257462</td>
      <td>42.156250</td>
      <td>13</td>
      <td>3</td>
      <td>0.120</td>
      <td>3586</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.25477 42.15317, 78.25478 42.15319...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.198357e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>13.06364</td>
      <td>G078248E42152N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.248267</td>
      <td>42.151885</td>
      <td>13</td>
      <td>3</td>
      <td>0.488</td>
      <td>3763</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.24228 42.15276, 78.24179 42.15291...</td>
      <td>0</td>
      <td>1.0</td>
      <td>4.878905e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13.06365</td>
      <td>G078247E42144N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.247108</td>
      <td>42.143715</td>
      <td>13</td>
      <td>3</td>
      <td>0.455</td>
      <td>3772</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.24121 42.14288, 78.24115 42.14316...</td>
      <td>0</td>
      <td>1.0</td>
      <td>4.554036e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>13.06366</td>
      <td>G078256E42146N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.256422</td>
      <td>42.145717</td>
      <td>13</td>
      <td>3</td>
      <td>0.064</td>
      <td>4091</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.25781 42.14643, 78.25795 42.14627...</td>
      <td>0</td>
      <td>1.0</td>
      <td>6.394580e+04</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>13.06367</td>
      <td>G078273E42129N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.272638</td>
      <td>42.128576</td>
      <td>13</td>
      <td>3</td>
      <td>0.838</td>
      <td>3886</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.27334 42.13093, 78.27335 42.13092...</td>
      <td>0</td>
      <td>1.0</td>
      <td>8.380628e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>13.06368</td>
      <td>G078248E42120N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.247623</td>
      <td>42.120056</td>
      <td>13</td>
      <td>3</td>
      <td>0.130</td>
      <td>3783</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.24502 42.1209, 78.24501 42.12111,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.303180e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>13.06369</td>
      <td>G078235E42101N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.235414</td>
      <td>42.101281</td>
      <td>13</td>
      <td>3</td>
      <td>1.530</td>
      <td>3542</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.22665 42.09609, 78.22619 42.09593...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.530797e+06</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>13.06370</td>
      <td>G078176E42094N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.175621</td>
      <td>42.094369</td>
      <td>13</td>
      <td>3</td>
      <td>0.051</td>
      <td>3715</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.17538 42.09485, 78.17582 42.0949,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>5.125522e+04</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>13.06371</td>
      <td>G078177E42081N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.177069</td>
      <td>42.081380</td>
      <td>13</td>
      <td>3</td>
      <td>0.079</td>
      <td>4111</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.17566 42.08282, 78.17543 42.08271...</td>
      <td>0</td>
      <td>1.0</td>
      <td>7.865735e+04</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>13.06372</td>
      <td>G078179E42089N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.178560</td>
      <td>42.088990</td>
      <td>13</td>
      <td>3</td>
      <td>1.188</td>
      <td>3717</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.18269 42.08684, 78.18287 42.08685...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.189120e+06</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>13.06373</td>
      <td>G078167E42090N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.166618</td>
      <td>42.090111</td>
      <td>13</td>
      <td>3</td>
      <td>0.053</td>
      <td>3711</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.16486 42.09286, 78.16512 42.09265...</td>
      <td>0</td>
      <td>1.0</td>
      <td>5.341084e+04</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>13.06374</td>
      <td>G078164E42077N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.163706</td>
      <td>42.077043</td>
      <td>13</td>
      <td>3</td>
      <td>0.242</td>
      <td>3821</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.16123 42.07615, 78.16121 42.07647...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.422097e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>13.06375</td>
      <td>G078169E42079N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.169405</td>
      <td>42.078847</td>
      <td>13</td>
      <td>3</td>
      <td>0.210</td>
      <td>3954</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.16569 42.08133, 78.16569 42.08144...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.103233e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>13.06376</td>
      <td>G078141E42092N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.140577</td>
      <td>42.092421</td>
      <td>13</td>
      <td>3</td>
      <td>0.312</td>
      <td>3789</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.14342 42.09126, 78.14307 42.0911,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>3.125316e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>13.06377</td>
      <td>G078137E42098N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.137046</td>
      <td>42.097894</td>
      <td>13</td>
      <td>3</td>
      <td>0.262</td>
      <td>3833</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.13993 42.09554, 78.13922 42.09586...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.623176e+05</td>
      <td>99.800692</td>
    </tr>
    <tr>
      <th>25</th>
      <td>13.06378</td>
      <td>G078142E42102N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.142325</td>
      <td>42.101983</td>
      <td>13</td>
      <td>3</td>
      <td>0.104</td>
      <td>3917</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.14482 42.10282, 78.14487 42.10251...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.044770e+05</td>
      <td>99.357849</td>
    </tr>
    <tr>
      <th>26</th>
      <td>13.06379</td>
      <td>G078149E42104N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.149436</td>
      <td>42.104376</td>
      <td>13</td>
      <td>3</td>
      <td>0.202</td>
      <td>3816</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.14606 42.10367, 78.14607 42.1037,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.018695e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>13.06380</td>
      <td>G078164E42125N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.163621</td>
      <td>42.125311</td>
      <td>13</td>
      <td>3</td>
      <td>0.557</td>
      <td>3619</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.16573 42.12234, 78.16524 42.12175...</td>
      <td>0</td>
      <td>1.0</td>
      <td>5.575186e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>28</th>
      <td>13.06381</td>
      <td>G078153E42181N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.153380</td>
      <td>42.180904</td>
      <td>13</td>
      <td>3</td>
      <td>0.461</td>
      <td>3615</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.15813 42.18126, 78.15832 42.18113...</td>
      <td>0</td>
      <td>1.0</td>
      <td>4.607761e+05</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>29</th>
      <td>13.06382</td>
      <td>G078144E42185N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.144120</td>
      <td>42.185207</td>
      <td>13</td>
      <td>3</td>
      <td>0.162</td>
      <td>3664</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.14286 42.18766, 78.14289 42.18785...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.618856e+05</td>
      <td>98.106150</td>
    </tr>
    <tr>
      <th>37</th>
      <td>13.06425</td>
      <td>G078148E42061N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.147941</td>
      <td>42.060576</td>
      <td>13</td>
      <td>3</td>
      <td>2.110</td>
      <td>3626</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.13917 42.05947, 78.13898 42.05981...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.111295e+06</td>
      <td>98.842830</td>
    </tr>
    <tr>
      <th>42</th>
      <td>13.07717</td>
      <td>G078158E42059N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.158126</td>
      <td>42.059389</td>
      <td>13</td>
      <td>3</td>
      <td>0.115</td>
      <td>4295</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.15995 42.06078, 78.16006 42.06067...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.149899e+05</td>
      <td>97.041495</td>
    </tr>
    <tr>
      <th>43</th>
      <td>13.07718</td>
      <td>G078157E42064N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.156536</td>
      <td>42.063639</td>
      <td>13</td>
      <td>3</td>
      <td>0.137</td>
      <td>3996</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.16032 42.06117, 78.16003 42.06088...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.365792e+05</td>
      <td>99.743848</td>
    </tr>
    <tr>
      <th>44</th>
      <td>13.07719</td>
      <td>G078162E42069N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.162144</td>
      <td>42.069490</td>
      <td>13</td>
      <td>3</td>
      <td>1.541</td>
      <td>3673</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.17268 42.07346, 78.17306 42.073, ...</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.542085e+06</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>47</th>
      <td>13.07926</td>
      <td>G078270E42120N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.270069</td>
      <td>42.119547</td>
      <td>13</td>
      <td>3</td>
      <td>2.825</td>
      <td>3580</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.28974 42.11692, 78.28933 42.1166,...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.825799e+06</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>48</th>
      <td>13.07927</td>
      <td>G078263E42108N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.262621</td>
      <td>42.108208</td>
      <td>13</td>
      <td>3</td>
      <td>2.422</td>
      <td>3517</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.28017 42.11207, 78.28018 42.11191...</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.423234e+06</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>49</th>
      <td>13.07930</td>
      <td>G078187E42078N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.186730</td>
      <td>42.077626</td>
      <td>13</td>
      <td>3</td>
      <td>3.804</td>
      <td>3499</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.19163 42.07564, 78.19154 42.07561...</td>
      <td>0</td>
      <td>1.0</td>
      <td>3.805955e+06</td>
      <td>99.910066</td>
    </tr>
    <tr>
      <th>50</th>
      <td>13.07931</td>
      <td>G078212E42082N</td>
      <td>20020825</td>
      <td>-9999999</td>
      <td>78.212159</td>
      <td>42.082173</td>
      <td>13</td>
      <td>3</td>
      <td>3.611</td>
      <td>3397</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>9</td>
      <td>None</td>
      <td>POLYGON ((78.20858 42.09121, 78.20871 42.09088...</td>
      <td>0</td>
      <td>1.0</td>
      <td>3.612619e+06</td>
      <td>99.438704</td>
    </tr>
  </tbody>
</table>
<p>38 rows × 27 columns</p>
</div></div></div>
</div>
<p>With an updated glacier outline we can now determine the <strong>final area of the catchment</strong> and the <strong>part covered by glaciers</strong>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catchment_new</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catchment_new</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span>
<span class="n">area_glac</span> <span class="o">=</span> <span class="n">rgi_in_catchment</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span>

<span class="n">area_glac</span> <span class="o">=</span> <span class="n">area_glac</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="mi">1000000</span>
<span class="n">area_cat</span> <span class="o">=</span> <span class="n">catchment_new</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000000</span>
<span class="n">cat_cent</span> <span class="o">=</span> <span class="n">catchment_new</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">centroid</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">cat_cent</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New catchment area is </span><span class="si">{</span><span class="n">area_cat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km²&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Glacierized catchment area is </span><span class="si">{</span><span class="n">area_glac</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km²&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>New catchment area is 300.66 km²
Glacierized catchment area is 31.83 km²
</pre></div>
</div>
</div>
</div>
<p>The files just created are added to the existing geopackage…</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rgi_in_catchment</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;rgi_in&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GPKG&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer &#39;rgi_in&#39; added to GeoPackage &#39;</span><span class="si">{</span><span class="n">output_gpkg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="n">rgi_out_catchment</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;rgi_out&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GPKG&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer &#39;rgi_out&#39; added to GeoPackage &#39;</span><span class="si">{</span><span class="n">output_gpkg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="n">catchment_new</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_gpkg</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;catchment_new&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GPKG&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer &#39;catchment_new&#39; added to GeoPackage &#39;</span><span class="si">{</span><span class="n">output_gpkg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Layer &#39;rgi_in&#39; added to GeoPackage &#39;output/catchment_data.gpkg&#39;
Layer &#39;rgi_out&#39; added to GeoPackage &#39;output/catchment_data.gpkg&#39;
Layer &#39;catchment_new&#39; added to GeoPackage &#39;output/catchment_data.gpkg&#39;
</pre></div>
</div>
</div>
</div>
<p>…and can also be added to the interactive map…</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c_new</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">geopandas_to_ee</span><span class="p">(</span><span class="n">catchment_new</span><span class="p">)</span>
<span class="n">rgi</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">geopandas_to_ee</span><span class="p">(</span><span class="n">rgi_in_catchment</span><span class="p">)</span>

<span class="k">if</span> <span class="n">show_map</span><span class="p">:</span>
    <span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">c_new</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">},</span> <span class="s2">&quot;Catchment New&quot;</span><span class="p">)</span>
    <span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">rgi</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span> <span class="s2">&quot;RGI60&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New layers added.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>New layers added.
</pre></div>
</div>
</div>
</div>
<p>→ <a class="reference internal" href="#map"><span class="xref myst">Jump to map</span></a> to see the results.</p>
<p>…or combined in a simple plot.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">catchment_new</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">rgi_in_catchment</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Catchment Area with Pouring Point and Glaciers&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figures_folder</span><span class="o">+</span><span class="s1">&#39;NB1_Glaciers_Catchment.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><img alt="_images/d07f2fa9634315066d98344a1e9a30e35c9ce62dfdb47a4307977064e5a0de6b.png" src="_images/d07f2fa9634315066d98344a1e9a30e35c9ce62dfdb47a4307977064e5a0de6b.png" />
</div>
</div>
<p>After adding the new catchment area to GEE, we can easily calculate the mean catchment elevation in meters above sea level.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ele_cat</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                          <span class="n">geometry</span><span class="o">=</span><span class="n">c_new</span><span class="p">)</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()[</span><span class="n">dem_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean catchment elevation (adjusted) is </span><span class="si">{</span><span class="n">ele_cat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m a.s.l.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean catchment elevation (adjusted) is 3271.90 m a.s.l.
</pre></div>
</div>
</div>
</div>
<section id="interim-summary">
<h3>Interim Summary:<a class="headerlink" href="#interim-summary" title="Link to this heading">#</a></h3>
<p>So far we have…</p>
<ul class="simple">
<li><p>…delineated the catchment and determined its area,</p></li>
<li><p>…calculated the average elevation of the catchment,</p></li>
<li><p>…identified the glaciers in the catchment and calculated their combined area.</p></li>
</ul>
<p>In the next step, we will create a glacier profile to determine how the ice is distributed over the elevation range.</p>
</section>
</section>
<hr class="docutils" />
<section id="retrieve-ice-thickness-rasters-and-corresponding-dem-files">
<h2>Retrieve ice thickness rasters and corresponding DEM files<a class="headerlink" href="#retrieve-ice-thickness-rasters-and-corresponding-dem-files" title="Link to this heading">#</a></h2>
<p>Determining ice thickness from remotely sensed data is a challenging task. Fortunately, <a class="reference external" href="https://doi.org/10.1038/s41561-019-0300-3">Farinotti et.al. (2019)</a> calculated an ensemble estimate of different methods for all glaciers in RGI6 and made the data available <a class="reference external" href="https://www.research-collection.ethz.ch/handle/20.500.11850/315707">to the public</a>.</p>
<p>The published repository contains…</p>
<blockquote>
<div><p>(a) the <strong>ice thickness distribution</strong> of individual glaciers,<br/>
(b) global grids at various resolutions with <strong>summary-information about glacier number, area, and volume</strong>, and<br/>
(c) the <strong>digital elevation models</strong> of the glacier surfaces used to produce the estimates.</p>
<p>Nomenclature for glaciers and regions follows the Randolph Glacier Inventory (RGI) version 6.0.</p>
<p>Source: Farinotti et.al. 2019 - <a class="reference external" href="https://www.research-collection.ethz.ch/bitstream/handle/20.500.11850/315707/README.txt">README</a></p>
</div></blockquote>
<p>The <strong>ice thickness rasters (a)</strong> and <strong>aligned DEMs (c)</strong> are the perfect input data for our glacier profile. The files are selected and downloaded by their <strong>RGI IDs</strong> and stored in the output folder.</p>
<p>Since the original files hosted by ETH Zurich are stored in large archives, we cut the dataset into smaller slices and reupload them according to the respective <a class="reference external" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">license</a> to make them searchable, improve performance, and limit traffic.</p>
<p>First, we identify the relevant archives for our set of glacier IDs.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getArchiveNames</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;ice_thickness_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;dem_surface_DEM_</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="c1"># determine relevant .zip files for derived RGI IDs </span>
<span class="n">df_rgiids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rgi_in_catchment</span><span class="p">[</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">())</span>
<span class="n">df_rgiids</span><span class="p">[[</span><span class="s1">&#39;thickness&#39;</span><span class="p">,</span> <span class="s1">&#39;dem&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df_rgiids</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getArchiveNames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">result_type</span><span class="o">=</span><span class="s1">&#39;expand&#39;</span><span class="p">)</span>
<span class="n">zips_thickness</span> <span class="o">=</span> <span class="n">df_rgiids</span><span class="p">[</span><span class="s1">&#39;thickness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">zips_dem</span> <span class="o">=</span> <span class="n">df_rgiids</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Thickness archives:</span><span class="se">\t</span><span class="si">{</span><span class="n">zips_thickness</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DEM archives:</span><span class="se">\t\t</span><span class="si">{</span><span class="n">zips_dem</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Thickness archives:	[&#39;ice_thickness_RGI60-13_7&#39;, &#39;ice_thickness_RGI60-13_8&#39;]
DEM archives:		[&#39;dem_surface_DEM_RGI60-13_7&#39;, &#39;dem_surface_DEM_RGI60-13_8&#39;]
</pre></div>
</div>
</div>
</div>
<p>The archives are stored on a file server at the Humboldt University of Berlin, which provides limited read access to this notebook. The corresponding credentials and API key are defined in the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file. The next step is to identify the corresponding resource references for the previously identified archives.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">resourcespace</span> <span class="kn">import</span> <span class="n">ResourceSpace</span>

<span class="c1"># use guest credentials to access media server </span>
<span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;MEDIA_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;api_base_url&#39;</span><span class="p">]</span>
<span class="n">private_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;MEDIA_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;private_key&#39;</span><span class="p">]</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;MEDIA_SERVER&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>

<span class="n">myrepository</span> <span class="o">=</span> <span class="n">ResourceSpace</span><span class="p">(</span><span class="n">api_base_url</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">private_key</span><span class="p">)</span>

<span class="c1"># get resource IDs for each .zip file</span>
<span class="n">refs_thickness</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">myrepository</span><span class="o">.</span><span class="n">get_collection_resources</span><span class="p">(</span><span class="mi">12</span><span class="p">))[[</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="s1">&#39;file_size&#39;</span><span class="p">,</span> <span class="s1">&#39;file_extension&#39;</span><span class="p">,</span> <span class="s1">&#39;field8&#39;</span><span class="p">]]</span>
<span class="n">refs_dem</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">myrepository</span><span class="o">.</span><span class="n">get_collection_resources</span><span class="p">(</span><span class="mi">21</span><span class="p">))[[</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="s1">&#39;file_size&#39;</span><span class="p">,</span> <span class="s1">&#39;file_extension&#39;</span><span class="p">,</span> <span class="s1">&#39;field8&#39;</span><span class="p">]]</span>

<span class="c1"># reduce list of resources two required zip files </span>
<span class="n">refs_thickness</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">zips_thickness</span><span class="p">,</span> <span class="n">refs_thickness</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;thickness&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;field8&#39;</span><span class="p">)</span>
<span class="n">refs_dem</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">zips_dem</span><span class="p">,</span> <span class="n">refs_dem</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;dem&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;field8&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Thickness archive references:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">refs_thickness</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DEM archive references:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">refs_dem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Thickness archive references:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>thickness</th>
      <th>ref</th>
      <th>file_size</th>
      <th>file_extension</th>
      <th>field8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ice_thickness_RGI60-13_7</td>
      <td>26948</td>
      <td>4397086</td>
      <td>zip</td>
      <td>ice_thickness_RGI60-13_7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ice_thickness_RGI60-13_8</td>
      <td>26986</td>
      <td>5380873</td>
      <td>zip</td>
      <td>ice_thickness_RGI60-13_8</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEM archive references:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dem</th>
      <th>ref</th>
      <th>file_size</th>
      <th>file_extension</th>
      <th>field8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>dem_surface_DEM_RGI60-13_7</td>
      <td>27206</td>
      <td>8669226</td>
      <td>zip</td>
      <td>dem_surface_DEM_RGI60-13_7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>dem_surface_DEM_RGI60-13_8</td>
      <td>27187</td>
      <td>11160282</td>
      <td>zip</td>
      <td>dem_surface_DEM_RGI60-13_8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Again, depending on the number of files and bandwidth, this may take a moment. Let’s start with the <strong>ice thickness</strong>…</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="n">cnt_thickness</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">file_names_thickness</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">refs_thickness</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">myrepository</span><span class="o">.</span><span class="n">get_resource_file</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_extension&#39;</span><span class="p">])</span>    
    <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">content</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipObj</span><span class="p">:</span>
        <span class="c1"># Get a list of all archived file names from the zip</span>
        <span class="n">listOfFileNames</span> <span class="o">=</span> <span class="n">zipObj</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rgiid</span> <span class="ow">in</span> <span class="n">df_rgiids</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_rgiids</span><span class="p">[</span><span class="s1">&#39;thickness&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;field8&#39;</span><span class="p">]][</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">rgiid</span> <span class="o">+</span> <span class="s1">&#39;_thickness.tif&#39;</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">listOfFileNames</span><span class="p">:</span>
                <span class="n">cnt_thickness</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">zipObj</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">+</span><span class="s1">&#39;RGI&#39;</span><span class="p">)</span>
                <span class="n">file_names_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File not found: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cnt_thickness</span><span class="si">}</span><span class="s1"> files have been extracted (ice thickness)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38 files have been extracted (ice thickness)
CPU times: user 142 ms, sys: 85.5 ms, total: 227 ms
Wall time: 12.4 s
</pre></div>
</div>
</div>
</div>
<p>…and continue with the matching <strong>DEMs</strong>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">cnt_dem</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">file_names_dem</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">refs_dem</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>   
    <span class="n">content</span> <span class="o">=</span> <span class="n">myrepository</span><span class="o">.</span><span class="n">get_resource_file</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">])</span>    
    <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">content</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipObj</span><span class="p">:</span>
        <span class="c1"># Get a list of all archived file names from the zip</span>
        <span class="n">listOfFileNames</span> <span class="o">=</span> <span class="n">zipObj</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rgiid</span> <span class="ow">in</span> <span class="n">df_rgiids</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_rgiids</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;field8&#39;</span><span class="p">]][</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;surface_DEM_</span><span class="si">{</span><span class="n">rgiid</span><span class="si">}</span><span class="s2">.tif&quot;</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">listOfFileNames</span><span class="p">:</span>
                <span class="n">cnt_dem</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">zipObj</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">+</span><span class="s1">&#39;RGI&#39;</span><span class="p">)</span>
                <span class="n">file_names_dem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File not found: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cnt_dem</span><span class="si">}</span><span class="s1"> files have been extracted (DEM)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38 files have been extracted (DEM)
CPU times: user 207 ms, sys: 97.9 ms, total: 305 ms
Wall time: 10.3 s
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-warning">
<b>Note:</b>
 Please check whether all files have been extracted to the output folder without error messages and <b>the number of files matches the number of glaciers</b>.</div><div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgi_in_catchment</span><span class="p">)</span> <span class="o">==</span> <span class="n">cnt_thickness</span> <span class="o">==</span> <span class="n">cnt_dem</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of files matches the number of glaciers within catchment: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rgi_in_catchment</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a mismatch of extracted files. Please check previous steps for error messages!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of included glaciers:</span><span class="se">\t</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rgi_in_catchment</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ice thickness files:</span><span class="se">\t\t</span><span class="si">{</span><span class="n">cnt_thickness</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DEM files:</span><span class="se">\t\t\t</span><span class="si">{</span><span class="n">cnt_dem</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of files matches the number of glaciers within catchment: 38
</pre></div>
</div>
</div>
</div>
</section>
<section id="glacier-profile-creation">
<h2>Glacier profile creation<a class="headerlink" href="#glacier-profile-creation" title="Link to this heading">#</a></h2>
<p>The <strong>glacier profile</strong> is used to pass the distribution of ice mass in the catchment to the glacio-hydrological model in <strong>Notebook 4</strong>, following the approach of <a class="reference external" href="https://doi.org/10.5194/hess-22-2211-2018">Seibert et.al.2018</a>. The model then calculates the annual mass balance and redistributes the ice mass accordingly.</p>
<p>To derive the profile from spatially distributed data, we first stack the ice thickness and corresponding DEM rasters for each glacier and create tuples of ice thickness and elevation values.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>

<span class="n">df_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">if</span> <span class="n">cnt_thickness</span> <span class="o">!=</span> <span class="n">cnt_dem</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of ice thickness raster files does not match number of DEM raster files!&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rgiid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_rgiids</span><span class="p">[</span><span class="s1">&#39;RGIId&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">rgiid</span> <span class="ow">in</span> <span class="n">file_names_thickness</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">and</span> <span class="n">rgiid</span> <span class="ow">in</span> <span class="n">file_names_dem</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;RGI/&#39;</span> <span class="o">+</span> <span class="n">file_names_thickness</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;RGI/&#39;</span> <span class="o">+</span> <span class="n">file_names_dem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="n">array_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Read arrays</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">geotransform</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span> <span class="c1"># Could be done more elegantly outside the for loop</span>
                <span class="n">projection</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetProjectionRef</span><span class="p">()</span>
                <span class="n">array_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
                <span class="n">pixelSizeX</span> <span class="o">=</span> <span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pixelSizeY</span> <span class="o">=-</span><span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>                
                <span class="n">src</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">df_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_all</span><span class="p">,</span> <span class="n">df</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Raster files do not match for </span><span class="si">{</span><span class="n">rgiid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ice thickness and elevations rasters stacked&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value pairs created&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ice thickness and elevations rasters stacked
Value pairs created
</pre></div>
</div>
</div>
</div>
<p>Now we can remove all data points with zero ice thickness and aggregate all data points into 10m <strong>elevation zones</strong>. The next step is to calculate the <strong>water equivalent</strong> (WE) from the average ice thickness in each elevation zone.</p>
<p>The result is exported to the output folder as <code class="docutils literal notranslate"><span class="pre">glacier_profile.csv</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">df_all</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;thickness&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">df_all</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># get min/max altitude considering catchment and all glaciers</span>
    <span class="n">alt_min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">catchment_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">alt_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">catchment_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">+</span><span class="mi">10</span>
        
    <span class="c1"># create bins in 10m steps</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">alt_min</span><span class="p">,</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># aggregate per bin and do some math</span>
    <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="p">))[</span><span class="s1">&#39;thickness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;Elevation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">pixelSizeX</span><span class="o">*</span><span class="n">pixelSizeY</span> <span class="o">/</span> <span class="n">catchment_new</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;area&#39;</span><span class="p">]</span>
    <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;WE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.908</span><span class="o">*</span><span class="mi">1000</span>
    <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;EleZone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">100</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
    
    <span class="c1"># delete empty elevation bands but keep at least one entry per elevation zone</span>
    <span class="n">df_agg</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">df_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;EleZone&#39;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    
    <span class="n">df_agg</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;altitude&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;glacier_profile.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Glacier profile for catchment created!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df_agg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Glacier profile for catchment created!
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Elevation</th>
      <th>Area</th>
      <th>WE</th>
      <th>EleZone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1970</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1900</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2100</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2100</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2200</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2200</td>
    </tr>
    <tr>
      <th>33</th>
      <td>2300</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2300</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>276</th>
      <td>4730</td>
      <td>0.000023</td>
      <td>20721.369141</td>
      <td>4700</td>
    </tr>
    <tr>
      <th>277</th>
      <td>4740</td>
      <td>0.000012</td>
      <td>14450.217773</td>
      <td>4700</td>
    </tr>
    <tr>
      <th>278</th>
      <td>4750</td>
      <td>0.000006</td>
      <td>10551.472656</td>
      <td>4700</td>
    </tr>
    <tr>
      <th>279</th>
      <td>4760</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4700</td>
    </tr>
    <tr>
      <th>281</th>
      <td>4780</td>
      <td>0.000002</td>
      <td>6084.745605</td>
      <td>4700</td>
    </tr>
  </tbody>
</table>
<p>161 rows × 4 columns</p>
</div></div></div>
</div>
<p>Let’s visualize the glacier profile. First we aggregate the ice mass in larger elevation zones for better visibility. The level of aggregation can be adjusted using the variable <code class="docutils literal notranslate"><span class="pre">steps</span></code> (default is 20m).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aggregation level for plot -&gt; feel free to adjust</span>
<span class="n">steps</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># get elevation range where glaciers are present</span>
<span class="n">we_range</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_agg</span><span class="p">[</span><span class="s1">&#39;WE&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Elevation&#39;</span><span class="p">]</span>
<span class="n">we_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">//</span> <span class="n">steps</span> <span class="o">*</span> <span class="n">steps</span>
<span class="n">plt_zones</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">we_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">//</span> <span class="n">steps</span> <span class="o">*</span> <span class="n">steps</span><span class="p">),</span> 
                            <span class="nb">int</span><span class="p">(</span><span class="n">we_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">//</span> <span class="n">steps</span> <span class="o">*</span> <span class="n">steps</span> <span class="o">+</span> <span class="n">steps</span><span class="p">),</span> 
                            <span class="n">steps</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;EleZone&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;EleZone&#39;</span><span class="p">)</span>

<span class="c1"># calculate glacier mass and aggregate glacier profile to defined elevation steps</span>
<span class="n">plt_data</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">plt_data</span><span class="p">[</span><span class="s1">&#39;EleZone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt_data</span><span class="p">[</span><span class="s1">&#39;Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">//</span> <span class="n">steps</span> <span class="o">*</span> <span class="n">steps</span><span class="p">))</span>
<span class="n">plt_data</span><span class="p">[</span><span class="s1">&#39;Mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt_data</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">catchment_new</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">plt_data</span><span class="p">[</span><span class="s1">&#39;WE&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-9</span> <span class="c1"># mass in Mt</span>
<span class="n">plt_data</span> <span class="o">=</span> <span class="n">plt_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Area&#39;</span><span class="p">,</span> <span class="s1">&#39;WE&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;EleZone&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;EleZone&#39;</span><span class="p">)</span>
<span class="n">plt_data</span> <span class="o">=</span> <span class="n">plt_zones</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plt_data</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">plt_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Elevation</th>
      <th>Mass</th>
    </tr>
    <tr>
      <th>EleZone</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3320</th>
      <td>6650</td>
      <td>0.061096</td>
    </tr>
    <tr>
      <th>3340</th>
      <td>6690</td>
      <td>0.485334</td>
    </tr>
    <tr>
      <th>3360</th>
      <td>6730</td>
      <td>1.311347</td>
    </tr>
    <tr>
      <th>3380</th>
      <td>6770</td>
      <td>2.808075</td>
    </tr>
    <tr>
      <th>3400</th>
      <td>6810</td>
      <td>5.413687</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4700</th>
      <td>9410</td>
      <td>0.410695</td>
    </tr>
    <tr>
      <th>4720</th>
      <td>9450</td>
      <td>0.402655</td>
    </tr>
    <tr>
      <th>4740</th>
      <td>9490</td>
      <td>0.073972</td>
    </tr>
    <tr>
      <th>4760</th>
      <td>4760</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4780</th>
      <td>4780</td>
      <td>0.003803</td>
    </tr>
  </tbody>
</table>
<p>74 rows × 2 columns</p>
</div></div></div>
</div>
<p>Now, we can plot the estimated <strong>glacier mass (in Mt) for each elevation zone.</strong></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt_data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Mass&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Glacier mass [Mt]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[::</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">/</span><span class="n">steps</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Elevation zone [m a.s.l.]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Initial Ice Distribution&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figures_folder</span><span class="o">+</span><span class="s1">&#39;NB1_Glacier_Mass_Elevation.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><img alt="_images/6630b6222ec4df03b1b52cc00621e759ef7a3550799487f780881e430e52dfff.png" src="_images/6630b6222ec4df03b1b52cc00621e759ef7a3550799487f780881e430e52dfff.png" />
</div>
</div>
<p>Finally, we calculate the average glacier elevation in meters above sea level.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ele_glac</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average glacier elevation in the catchment: </span><span class="si">{</span><span class="n">ele_glac</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> m a.s.l.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average glacier elevation in the catchment: 4001.88 m a.s.l.
</pre></div>
</div>
</div>
</div>
</section>
<section id="store-calculated-values-for-other-notebooks">
<h2>Store calculated values for other notebooks<a class="headerlink" href="#store-calculated-values-for-other-notebooks" title="Link to this heading">#</a></h2>
<p>Create a <code class="docutils literal notranslate"><span class="pre">settings.yml</span></code> and store the relevant catchment information for the model setup:</p>
<ul class="simple">
<li><p><strong>area_cat</strong>: area of the catchment in km²</p></li>
<li><p><strong>ele_cat</strong>: average elevation of the catchment in m.a.s.l.</p></li>
<li><p><strong>area_glac</strong>: glacier covered area as of 2000 in km²</p></li>
<li><p><strong>ele_glac</strong>: average elevation of glacier covered area in m.a.s.l.</p></li>
<li><p><strong>lat</strong>: latitude of catchment centroid</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;area_cat&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">area_cat</span><span class="p">),</span>
            <span class="s1">&#39;ele_cat&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">ele_cat</span><span class="p">),</span>
            <span class="s1">&#39;area_glac&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">area_glac</span><span class="p">),</span>
            <span class="s1">&#39;ele_glac&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">ele_glac</span><span class="p">),</span>
            <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
           <span class="p">}</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;settings.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Settings saved to file.&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="s1">&#39;Value&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Parameter&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Settings saved to file.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Value</th>
    </tr>
    <tr>
      <th>Parameter</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>area_cat</th>
      <td>300.663718</td>
    </tr>
    <tr>
      <th>ele_cat</th>
      <td>3271.895648</td>
    </tr>
    <tr>
      <th>area_glac</th>
      <td>31.829413</td>
    </tr>
    <tr>
      <th>ele_glac</th>
      <td>4001.879883</td>
    </tr>
    <tr>
      <th>lat</th>
      <td>42.185117</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can now continue with <a class="reference internal" href="Notebook2_Forcing_data.html"><span class="std std-doc">Notebook 2</span></a> or …</p>
</section>
<section id="optional-download-outputs">
<h2><em>Optional</em>: Download Outputs<a class="headerlink" href="#optional-download-outputs" title="Link to this heading">#</a></h2>
<div class="alert alert-block alert-info">
<b>Note:</b>
 The output folder is zipped at the end of each notebook and can be downloaded (file <code>output_download.zip</code>). This is especially useful if you want to use the binder environment again, but don't want to start over from Notebook 1.</div>
<p><img alt="Example out_download.zip" src="_images/download_output.png" /></p>
<a class="reference internal image-reference" href="_images/download_output.png"><img alt="Example out_download.zip" src="_images/download_output.png" style="width: 300px;" /></a>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">&#39;output_download&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output folder can be download now (file output_download.zip)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Output folder can be download now (file output_download.zip)
</pre></div>
</div>
</div>
</div>
<p>Now reset the variables and clear buffer.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Notebook0_Introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="Notebook2_Forcing_data.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Climate forcing data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#start-gee-and-download-dem">Start GEE and download DEM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catchment-deliniation">Catchment deliniation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-glaciers-in-catchment-area">Determine glaciers in catchment area</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim Summary:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-ice-thickness-rasters-and-corresponding-dem-files">Retrieve ice thickness rasters and corresponding DEM files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glacier-profile-creation">Glacier profile creation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#store-calculated-values-for-other-notebooks">Store calculated values for other notebooks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-download-outputs"><em>Optional</em>: Download Outputs</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Phillip Schuster
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>